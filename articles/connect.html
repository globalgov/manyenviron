<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How Do Environmental Treaties Connect? • manyenviron</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="How Do Environmental Treaties Connect?">
<meta property="og:description" content="manyenviron">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">manyenviron</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/connect.html">How Do Environmental Treaties Connect?</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://globalgov.github.io/qData/">qData</a>
    </li>
    <li>
      <a href="https://globalgov.github.io/manypkgs/">manypkgs</a>
    </li>
    <li>
      <a href="https://globalgov.github.io/qStates/">qStates</a>
    </li>
    <li>
      <a href="https://globalgov.github.io/qTrade/">qTrade</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/globalgov/manyenviron">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="connect_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>How Do Environmental Treaties Connect?</h1>
            
            <h4 class="date">2021-11-25</h4>
      
      
      <div class="hidden name"><code>connect.Rmd</code></div>

    </div>

    
    
<div id="manyenviron-data" class="section level2">
<h2 class="hasAnchor">
<a href="#manyenviron-data" class="anchor"></a>Manyenviron Data</h2>
<p><code>{manyenviron}</code> stores several datasets on various aspects of environmental treaties in different databases. For example, the <strong>Agreements</strong> database is made of multiple datasets of environmental treaty titles with specific information such as the agreement type (e.g. agreements, protocols, amendments, declarations), if they are bilateral or multilateral, and some important dates such as the signature or entry into force. The <strong>Memberships</strong> database contains lists of countries with the treaties to which they are parties to. It also includes information on the signature date of the treaty or the withdrawal date of a party. The <strong>References</strong> database is composed of a dataset that indicates the relationship (e.g. amended by, cites, superseded by) between two treaties. Finally, the <strong>Texts</strong> database stores the text of environmental treaties.</p>
<p>For a quick overview of the database and dataset in <code>{manyenviron}</code>, we can use the <code>data_contrast()</code> function from <code>{qData}</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">qData</span><span class="op">)</span>
<span class="fu">qData</span><span class="fu">::</span><span class="fu">data_contrast</span><span class="op">(</span><span class="st">"manyenviron"</span>, <span class="st">"agreements"</span>, <span class="st">"IEADB"</span><span class="op">)</span>
<span class="fu">qData</span><span class="fu">::</span><span class="fu">data_contrast</span><span class="op">(</span><span class="st">"manyenviron"</span>, <span class="st">"memberships"</span><span class="op">)</span></code></pre></div>
<p>To view the bibliographic references for a dataset, a database, or the whole package, we can also use <code>code_source()</code> from <code>{qData}</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">qData</span><span class="fu">::</span><span class="fu">data_source</span><span class="op">(</span><span class="st">"manyenviron"</span>, <span class="st">"agreements"</span>, <span class="st">"IEADB"</span><span class="op">)</span>
<span class="fu">qData</span><span class="fu">::</span><span class="fu">data_source</span><span class="op">(</span><span class="st">"manyenviron"</span>, <span class="st">"memberships"</span><span class="op">)</span>
<span class="fu">qData</span><span class="fu">::</span><span class="fu">data_source</span><span class="op">(</span><span class="st">"manyenviron"</span><span class="op">)</span></code></pre></div>
</div>
<div id="connecting-environmental-treaties" class="section level2">
<h2 class="hasAnchor">
<a href="#connecting-environmental-treaties" class="anchor"></a>Connecting Environmental Treaties</h2>
<p>There are many different ways in which treaties could be linked. For example, a treaty can be substituted by another, complemented by protocols, changed through amendments, and/or cite another treaty. To facilitate the identification and connection between the databases in the package, the <code>manypkgs::code_agreements()</code> function has been developed to generate a qID for treaties in a database. Each of the <code>{manyenviron}</code> dataset contains a qID column. To understand what are the information provided through by the qID, as well as the benefits of using qID to spot the relationships between the treaties across several datasets in a database, please visit this <a href="https://globalgov.github.io/manypkgs/articles/agreements.html">article</a> on the <code>{manypkgs}</code> website.</p>
<p>Below are two examples of how to visualise treaty linkages for the references and the memberships databases in <code>{manyenviron}</code>. We use <a href="https://github.com/snlab-ch/migraph">migraph</a> to create the network plots, more information about the package can be found <a href="https://snlab-ch.github.io/migraph/">here</a>.</p>
<div id="visualising-how-agreements-connect-by-references" class="section level3">
<h3 class="hasAnchor">
<a href="#visualising-how-agreements-connect-by-references" class="anchor"></a>Visualising How Agreements Connect by References</h3>
<p>The graph below illustrates a sample of earliest 25 treaties from the references database. We select only treaties that cite other treaties. The qIDs are used to facilitate the reading and illustration of the relationships.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/snlab-ch/migraph">migraph</a></span><span class="op">)</span>

<span class="co"># Get dataset</span>
<span class="va">references</span> <span class="op">&lt;-</span> <span class="fu">manyenviron</span><span class="fu">::</span><span class="va"><a href="../reference/references.html">references</a></span><span class="op">$</span><span class="va">ECOLEX_REF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">qID2</span>, <span class="st">"[:digit:]{4}"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">RefType</span> <span class="op">==</span> <span class="st">"Cites"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>

<span class="co"># Plot with migraph</span>
<span class="fu">migraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/migraph/man/gglineage.html">gglineage</a></span><span class="op">(</span><span class="va">references</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">25</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Treaty Lineage of Selected Agreements"</span>,
       caption <span class="op">=</span> <span class="st">"Source: manyenviron"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"sans"</span>,
                                  size <span class="op">=</span> <span class="fl">18</span>,
                                  hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="connect_files/figure-html/lineage-1.png" width="672" style="display: block; margin: auto;"></p>
<p>We can also take a look at a single lineage of Enviromental treaties. Let’s look at treaties that ammend the Ramsar Convention on Wetlands of International Importance Especially as Waterfowl Habitat (“RAMSA_1971A”).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Subset dataset</span>
<span class="va">ramsa</span> <span class="op">&lt;-</span> <span class="fu">manyenviron</span><span class="fu">::</span><span class="va"><a href="../reference/references.html">references</a></span><span class="op">$</span><span class="va">ECOLEX_REF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">qID2</span>, <span class="st">"[:digit:]{4}"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">RefType</span> <span class="op">==</span> <span class="st">"Amends"</span> <span class="op">&amp;</span> <span class="va">qID2</span> <span class="op">==</span> <span class="st">"RAMSA_1971A"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>

<span class="co"># Get agreement titles</span>
<span class="va">agreementtitles</span> <span class="op">&lt;-</span> <span class="fu">manyenviron</span><span class="fu">::</span><span class="va"><a href="../reference/agreements.html">agreements</a></span><span class="op">$</span><span class="va">ECOLEX</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Title</span>, <span class="va">qID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>qID1 <span class="op">=</span> <span class="va">qID</span><span class="op">)</span>

<span class="co"># Join information</span>
<span class="va">ramsa</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">ramsa</span>, <span class="va">agreementtitles</span>, by <span class="op">=</span> <span class="st">"qID1"</span><span class="op">)</span>
<span class="va">ramsa</span><span class="op">$</span><span class="va">qID2</span> <span class="op">&lt;-</span> <span class="st">"Ramsar Convention on Wetlands of International Importance Especially as Waterfowl Habitat - 1971"</span>
<span class="va">ramsa</span><span class="op">$</span><span class="va">Title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">ramsa</span><span class="op">$</span><span class="va">Title</span>, <span class="st">"-"</span>, <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">ramsa</span><span class="op">$</span><span class="va">qID1</span>, <span class="st">"[:digit:]{4}"</span><span class="op">)</span><span class="op">)</span>
<span class="va">ramsa</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">ramsa</span>, <span class="va">qID2</span>, <span class="va">Title</span><span class="op">)</span>

<span class="co"># Plot with migraph</span>
<span class="fu">migraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/migraph/man/gglineage.html">gglineage</a></span><span class="op">(</span><span class="va">ramsa</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Treaties that Amend the Ramsar Convention"</span>,
       caption <span class="op">=</span> <span class="st">"Source: manyenviron"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"sans"</span>,
                                  size <span class="op">=</span> <span class="fl">18</span>,
                                  hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="connect_files/figure-html/ramsar-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="visualising-how-agreements-connect-by-country-membership" class="section level3">
<h3 class="hasAnchor">
<a href="#visualising-how-agreements-connect-by-country-membership" class="anchor"></a>Visualising How Agreements Connect by Country Membership</h3>
<p>The graph below illustrates the connection between parties and treaties for environmental agreements signed into force in two points in time, 1960 and 1980, using the memberships database. In the graph, countries are represented by the dots, the treaties by the squares, and memberships by the edges. qIDs are also used to refer to treaty titles.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Subset dataset</span>
<span class="va">membership_1960</span> <span class="op">&lt;-</span> <span class="fu">manyenviron</span><span class="fu">::</span><span class="va"><a href="../reference/memberships.html">memberships</a></span><span class="op">$</span><span class="va">IEADB_MEM</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">qID_ref</span>, <span class="st">"[:digit:]{4}"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="st">"1960"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">qID</span>, <span class="va">CountryID</span>, <span class="va">Title</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">migraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/migraph/man/coercion.html">as_tidygraph</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Plot with migraph</span>
<span class="fu">migraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/migraph/man/autographr.html">autographr</a></span><span class="op">(</span><span class="va">membership_1960</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Membership in Environmental Treaties\nSigned in 1960"</span>,
       caption <span class="op">=</span> <span class="st">"Source: manyenviron"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"sans"</span>,
                                  size <span class="op">=</span> <span class="fl">18</span>,
                                  hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="connect_files/figure-html/memberships-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Subset dataset</span>
<span class="va">membership_1980</span> <span class="op">&lt;-</span> <span class="fu">manyenviron</span><span class="fu">::</span><span class="va"><a href="../reference/memberships.html">memberships</a></span><span class="op">$</span><span class="va">IEADB_MEM</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">qID_ref</span>, <span class="st">"[:digit:]{4}"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="st">"1980"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">qID</span>, <span class="va">CountryID</span>, <span class="va">Title</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">migraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/migraph/man/coercion.html">as_tidygraph</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Plot with migraph</span>
<span class="fu">migraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/migraph/man/autographr.html">autographr</a></span><span class="op">(</span><span class="va">membership_1980</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Membership in Environmental Treaties\nSigned in 1980"</span>,
       caption <span class="op">=</span> <span class="st">"Source: manyenviron"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"sans"</span>,
                                  size <span class="op">=</span> <span class="fl">18</span>,
                                  hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="connect_files/figure-html/memberships-2.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="visulaizing-the-plots-in-3d" class="section level3">
<h3 class="hasAnchor">
<a href="#visulaizing-the-plots-in-3d" class="anchor"></a>Visulaizing the Plots in 3D</h3>
<p>Visualizing the network in 3D is a neat way of presenting your data in HTML documents. This allows you to let the visitors of your site interact with your network by allowing them to move things around. To get there, we leverage the <a href="https://bwlewis.github.io/rthreejs/"><code>{threejs}</code></a> package, an interface between R and the eponymous JS library.</p>
<p>We will use the membership data for agreements signed in 1980 from above and set a node attribute <code>lvl</code> identifying the set a node belongs to. We then move on to subsetting the graph by only retaining the biggest component and applying the <code><a href="http://graphlayouts.schochastics.net/reference/layout_multilevel.html">layout_as_multilevel()</a></code> function. We finally make some cosmetic adjustments before rendering the graph. (Note that you can hover over a node to display its name!)</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://igraph.org">igraph</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://bwlewis.github.io/rthreejs">threejs</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://graphlayouts.schochastics.net/">graphlayouts</a></span><span class="op">)</span>

<span class="co"># Set node attributes "lvl" to separate between countries and agreements</span>
<span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html">V</a></span><span class="op">(</span><span class="va">membership_1980</span><span class="op">)</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html">V</a></span><span class="op">(</span><span class="va">membership_1980</span><span class="op">)</span><span class="op">$</span><span class="va">name</span><span class="op">)</span> <span class="op">==</span> <span class="fl">3</span>,
                                   <span class="cn">TRUE</span>,
                                   <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html">V</a></span><span class="op">(</span><span class="va">membership_1980</span><span class="op">)</span><span class="op">$</span><span class="va">lvl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html">V</a></span><span class="op">(</span><span class="va">membership_1980</span><span class="op">)</span><span class="op">$</span><span class="va">type</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>

<span class="co"># Subset the graph to only include the biggest component</span>
<span class="va">components</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/components.html">components</a></span><span class="op">(</span><span class="va">membership_1980</span><span class="op">)</span>
<span class="va">biggest_component_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">components</span><span class="op">$</span><span class="va">csize</span><span class="op">)</span>
<span class="va">vert_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html">V</a></span><span class="op">(</span><span class="va">membership_1980</span><span class="op">)</span><span class="op">[</span><span class="va">components</span><span class="op">$</span><span class="va">membership</span> <span class="op">==</span> <span class="va">biggest_component_id</span><span class="op">]</span>
<span class="va">membership_1980</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/subgraph.html">induced_subgraph</a></span><span class="op">(</span><span class="va">membership_1980</span>, <span class="va">vert_ids</span><span class="op">)</span>

<span class="co"># Define the 3D layout</span>
<span class="va">membership_1980</span><span class="op">$</span><span class="va">layout</span> <span class="op">&lt;-</span> <span class="fu">graphlayouts</span><span class="fu">::</span><span class="fu"><a href="http://graphlayouts.schochastics.net/reference/layout_multilevel.html">layout_as_multilevel</a></span><span class="op">(</span><span class="va">membership_1980</span>, type <span class="op">=</span> <span class="st">"all"</span>,
                                                             alpha <span class="op">=</span> <span class="fl">25</span>, beta <span class="op">=</span> <span class="fl">45</span>,
                                                             project2D <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html">V</a></span><span class="op">(</span><span class="va">membership_1980</span><span class="op">)</span><span class="op">$</span><span class="va">color</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#014D23"</span>, <span class="st">"#36648A"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html">V</a></span><span class="op">(</span><span class="va">membership_1980</span><span class="op">)</span><span class="op">$</span><span class="va">lvl</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html">V</a></span><span class="op">(</span><span class="va">membership_1980</span><span class="op">)</span><span class="op">$</span><span class="va">vertex.label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html">V</a></span><span class="op">(</span><span class="va">membership_1980</span><span class="op">)</span><span class="op">$</span><span class="va">name</span>

<span class="co"># Render the graph</span>
<span class="fu">graphjs</span><span class="op">(</span><span class="va">membership_1980</span>, main <span class="op">=</span> <span class="st">"Membership in Environmental Treaties Signed in 1980"</span>,
        bg <span class="op">=</span> <span class="st">"white"</span>, vertex.label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html">V</a></span><span class="op">(</span><span class="va">membership_1980</span><span class="op">)</span><span class="op">$</span><span class="va">vertex.label</span>,
        vertex.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html">V</a></span><span class="op">(</span><span class="va">membership_1980</span><span class="op">)</span><span class="op">$</span><span class="va">lvl</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fl">0.8</span>, <span class="fl">2</span><span class="op">)</span>,
        vertex.shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html">V</a></span><span class="op">(</span><span class="va">membership_1980</span><span class="op">)</span><span class="op">$</span><span class="va">lvl</span> <span class="op">==</span> <span class="fl">1</span>, <span class="st">"square"</span>, <span class="st">"sphere"</span><span class="op">)</span>,
        top <span class="op">=</span> <span class="fl">1</span>, left <span class="op">=</span> <span class="fl">45</span>, font.main <span class="op">=</span> <span class="st">"18px Arial"</span>, brush <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="projecting-the-network-on-a-globe" class="section level3">
<h3 class="hasAnchor">
<a href="#projecting-the-network-on-a-globe" class="anchor"></a>Projecting the Network on a Globe:</h3>
<p>Let’s look at what the “country projection” of the bimodal network above looks like on a globe. Note that projections as such can sometimes obscur information about the underlying bimodal network. There are essentially two elements we need for this visualization. First, the country projection of treaties signed in 1980 which we computed before. Second, a dataframe of the centroids of every country in the world which we get from the <a href="https://r-forge.r-project.org/projects/rgeos/">rgeos</a> and the <a href="https://github.com/AndySouth/rworldmap/">rworldmap</a> packages. Once we have these elements, we merge them to create dataframe for the arcs to be displayed in the <code>globejs()</code> visualization. Finally, we adjust colors and inital longitude and latitude for the plotted globe.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/rgeos/">rgeos</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/AndySouth/rworldmap/">rworldmap</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>

<span class="co"># Create the projection</span>
<span class="va">membership_1980</span> <span class="op">&lt;-</span> <span class="fu">migraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/migraph/man/project.html">project_cols</a></span><span class="op">(</span><span class="va">membership_1980</span><span class="op">)</span>
<span class="va">membership_1980</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/graph_from_data_frame.html">get.data.frame</a></span><span class="op">(</span><span class="va">membership_1980</span>, <span class="st">"edges"</span><span class="op">)</span>

<span class="co"># Get the coordinates of the centroids of each territory</span>
<span class="va">wmap</span> <span class="op">&lt;-</span> <span class="fu">getMap</span><span class="op">(</span>resolution<span class="op">=</span><span class="st">"high"</span><span class="op">)</span>
<span class="va">centroids</span> <span class="op">&lt;-</span> <span class="fu">gCentroid</span><span class="op">(</span><span class="va">wmap</span>, byid<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">centroids</span><span class="op">$</span><span class="va">ID</span> <span class="op">&lt;-</span> <span class="fu">countrycode</span><span class="fu">::</span><span class="fu">countrycode</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">centroids</span><span class="op">)</span><span class="op">)</span>,
                                         <span class="st">"country.name"</span>, <span class="st">"cowc"</span><span class="op">)</span>
<span class="va">centroids</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">centroids</span><span class="op">)</span> <span class="op"><a href="https://tidyr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>lat <span class="op">=</span> <span class="va">y</span>, long <span class="op">=</span> <span class="va">x</span><span class="op">)</span> <span class="op"><a href="https://tidyr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span>

<span class="co"># Merge centroids and links dataframes</span>
<span class="va">merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">centroids</span>, <span class="va">membership_1980</span>, by.x <span class="op">=</span> <span class="st">"ID"</span>, by.y <span class="op">=</span> <span class="st">"from"</span><span class="op">)</span>
<span class="va">merged</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="va">merged</span>, origin_long <span class="op">=</span> <span class="va">long</span>, origin_lat <span class="op">=</span> <span class="va">lat</span><span class="op">)</span>
<span class="va">merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">centroids</span>, <span class="va">merged</span>, by.x <span class="op">=</span> <span class="st">"ID"</span>, by.y <span class="op">=</span> <span class="st">"to"</span><span class="op">)</span>
<span class="va">merged</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="va">merged</span>, dest_lat <span class="op">=</span> <span class="va">lat</span>, dest_long <span class="op">=</span> <span class="va">long</span>,ID_from <span class="op">=</span> <span class="va">ID</span>, ID_to <span class="op">=</span> <span class="va">ID.y</span><span class="op">)</span> <span class="op"><a href="https://tidyr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">ID_from</span>, <span class="va">ID_to</span>, <span class="va">origin_lat</span>, <span class="va">origin_long</span>, <span class="va">dest_lat</span>, <span class="va">dest_long</span><span class="op">)</span>

<span class="co"># Create arcs dataframe</span>
<span class="va">keeps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"origin_lat"</span>, <span class="st">"origin_long"</span>, <span class="st">"dest_lat"</span>, <span class="st">"dest_long"</span><span class="op">)</span>
<span class="va">arcs</span> <span class="op">&lt;-</span> <span class="va">merged</span><span class="op">[</span><span class="va">keeps</span><span class="op">]</span>

<span class="co"># Visualize</span>
<span class="fu">threejs</span><span class="fu">::</span><span class="fu">globejs</span><span class="op">(</span>lat<span class="op">=</span><span class="va">merged</span><span class="op">$</span><span class="va">dest_lat</span>, long<span class="op">=</span><span class="va">merged</span><span class="op">$</span><span class="va">dest_long</span>,
        arcs <span class="op">=</span> <span class="va">arcs</span>, bodycolor <span class="op">=</span> <span class="st">"#aaaaff"</span>,
        rotationlong <span class="op">=</span> <span class="fl">200</span>, rotationlat <span class="op">=</span> <span class="op">-</span><span class="fl">100</span>,
        arcsHeight <span class="op">=</span> <span class="fl">0.3</span>, arcsLwd <span class="op">=</span> <span class="fl">2.5</span>,
        arcsColor <span class="op">=</span> <span class="st">"#2fff00"</span>, arcsOpacity <span class="op">=</span> <span class="fl">0.15</span>,
        atmosphere <span class="op">=</span> <span class="cn">TRUE</span>, color<span class="op">=</span><span class="st">"#00aaff"</span>, pointsize <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://jameshollway.com">James Hollway</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
